{"componentChunkName":"component---src-templates-blog-post-js","path":"/writings/pt/api-geolocation","result":{"data":{"markdownRemark":{"html":"<p>Depois de tanto tempo distante, para ser mais preciso 1 mês e 16 dias estou de volta e hoje vou falar sobre a <a href=\"https://www.google.com.br/search?q=geolocation+api+html5&#x26;oq=geolocation+api+html5&#x26;aqs=chrome..69i57j69i65j0l4.2541j0j7&#x26;sourceid=chrome&#x26;espv=210&#x26;es_sm=119&#x26;ie=UTF-8\">API Geolocation do HTML5</a>, que por sinal já é “bastante” antiga mas eu ainda não tinha conseguido fazer nada com ela, nem se quer mostrar um mapa :( Maaas agora as coisas mudaram, depois de ver com calma e brincar um pouco, finalmente consegui utiliza-la e hoje irei mostrar como, <strong>LET’S WORK</strong>!</p>\n<p>O resultado deste post é este <a href=\"http://thulioph.github.io/geolocation/\">aqui</a> e você pode ver todo o código comentado <a href=\"https://github.com/thulioph/geolocation\">aqui</a>.</p>\n<h2>Iniciando</h2>\n<p>A api é bastante simples e este é seu código:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">navigator<span class=\"token punctuation\">.</span>geolocation<span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentPosition</span><span class=\"token punctuation\">(</span>success<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<blockquote>\n<p>Papaya with sugar hein?</p>\n</blockquote>\n<p>Você passa como parâmetros duas funções callback: <strong>success</strong> e <strong>error</strong>, que irão determinar o que vai acontecer caso o usuário permita ser localizado ou não.</p>\n<h3>Success</h3>\n<p>Caso o usuário permita ser localizado, esta função irá me retornar o mapa com a sua localização e um pin marcando.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">position</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">var</span> status <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">.</span>className <span class=\"token operator\">==</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n\n   status<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">;</span>\n   status<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Sua localização está no mapa abaixo.'</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">var</span> myLatlng <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>LatLng</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">.</span>coords<span class=\"token punctuation\">.</span>latitude<span class=\"token punctuation\">,</span>\n   position<span class=\"token punctuation\">.</span>coords<span class=\"token punctuation\">.</span>longitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">var</span> mapOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      zoom<span class=\"token operator\">:</span> <span class=\"token number\">17</span><span class=\"token punctuation\">,</span>\n      center<span class=\"token operator\">:</span> myLatlng<span class=\"token punctuation\">,</span>\n      panControl<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      scrollwheel<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      mapTypeId<span class=\"token operator\">:</span> google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>MapTypeId<span class=\"token punctuation\">.</span><span class=\"token constant\">ROADMAP</span>\n   <span class=\"token punctuation\">}</span>\n\n   <span class=\"token keyword\">var</span> contentString <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;h2>Você está aqui&lt;/h2>'</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'&lt;p>Este foi um exemplo de como pegar a geolocalização do usuário&lt;/p>'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">var</span> infowindow <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>InfoWindow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      content<span class=\"token operator\">:</span> contentString<span class=\"token punctuation\">,</span>\n      maxWidth<span class=\"token operator\">:</span> <span class=\"token number\">700</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">var</span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>Map</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mapuser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mapOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">var</span> image <span class=\"token operator\">=</span> <span class=\"token string\">'https://cdn2.iconfinder.com/data/icons/snipicons/500/map-marker-128.png'</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">var</span> marcadorPersonalizado <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>Marker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      position<span class=\"token operator\">:</span> myLatlng<span class=\"token punctuation\">,</span>\n      map<span class=\"token operator\">:</span> map<span class=\"token punctuation\">,</span>\n      icon<span class=\"token operator\">:</span> image<span class=\"token punctuation\">,</span>\n      animation<span class=\"token operator\">:</span> google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>Animation<span class=\"token punctuation\">.</span><span class=\"token constant\">BOUNCE</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>event<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>marcadorPersonalizado<span class=\"token punctuation\">,</span> <span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      infowindow<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">,</span>marcadorPersonalizado<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>O que foi feito?</p>\n<p>Criei uma variável <code class=\"language-text\">status</code> que recebe o id com o mesmo nome que foi determinado no meu html. E se <code class=\"language-text\">status</code> receber a classe <code class=\"language-text\">success</code> ele retorna tudo que estiver dentro da função <code class=\"language-text\">success</code>.</p>\n<p>O que a função success faz?</p>\n<ul>\n<li>Adição da classe success através do <code class=\"language-text\">status.className</code>.</li>\n<li>Através do <code class=\"language-text\">status.innerHTML</code> foi passado um texto que irá informar uma mensagem ao usuário.</li>\n<li>A exibição do mapa através das coordenadas que foram retornadas pela API quando o usuário aceitou ser localizado e a estilização do mapa incluindo um pin e ocultando algumas opções do mapa.</li>\n</ul>\n<p>Sobre a exibição do mapa, recomendo ler o material onde <a href=\"http://thulioph.com/writings/pt/google-maps-api-v3\">falo tudo sobre a api do google maps</a> e a única diferença nesta parte foi que inseri o retorno <code class=\"language-text\">position.coords.latitude</code>, <code class=\"language-text\">position.coords.longitude</code> da api na variável <code class=\"language-text\">myLatlng</code> e não declarei a latitude e longitude como no exemplo do outro post.</p>\n<h3>Error</h3>\n<p>Caso o usuário não permita ser localizado, esta função irá me retornar uma mensagem informando que o usuário não permitiu ser localizado.</p>\n<p>Na função error eu tenho:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> status <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  status<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> msg <span class=\"token operator\">==</span> <span class=\"token string\">'string'</span> <span class=\"token operator\">?</span> msg <span class=\"token operator\">:</span> <span class=\"token string\">'Você não permitiu ser localizado.'</span><span class=\"token punctuation\">;</span>\n  status<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'fail'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>O que foi feito?</p>\n<p>Criei uma variável <code class=\"language-text\">status</code> que recebe o id com o mesmo nome que foi declarado no meu html.</p>\n<p>O que a função <strong>error</strong> faz?</p>\n<ul>\n<li>Adição da classe fail através do <code class=\"language-text\">status.className</code>.</li>\n<li>Através do <code class=\"language-text\">status.innerHTML</code> foi passado um texto que irá informar uma mensagem ao usuário.</li>\n</ul>\n<p>Resumindo A API é bastante simples e te retorna dois valores <code class=\"language-text\">position.coords.latitude</code> onde indica a latitude e <code class=\"language-text\">position.coords.longitude</code> onde indica a longitude, só precisei indicar onde queria esse resultado e o resto eu já tinha feito praticamente tudo no outro <a href=\"http://thulioph.com/writings/pt/google-maps-api-v3\">post</a>.</p>\n<p>Espero que vocês tenham entendido e feedbacks são sempre bem vindos.</p>\n<p>Links de Referência:</p>\n<ul>\n<li><a href=\"http://tableless.com.br/html5/?chapter=24\">http://tableless.com.br/html5/?chapter=24</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/WebAPI/Using_geolocation\">https://developer.mozilla.org/en-US/docs/WebAPI/Using_geolocation</a></li>\n</ul>","frontmatter":{"date":"March 10, 2014","path":"/writings/pt/api-geolocation","title":"API Geolocation","imageSlug":""},"fields":{"readingTime":{"text":"3 min read"}}}},"pageContext":{"pathSlug":"/writings/pt/api-geolocation","next":{"frontmatter":{"path":"/writings/pt/front-in-aracaju","title":"Front In Aracaju"}},"prev":{"frontmatter":{"path":"/writings/pt/bom-uso-redes-sociais","title":"O Bom uso das Redes Sociais"}}}}}